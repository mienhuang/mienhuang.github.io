<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  
  
    <meta name="keywords" content="blog grown diary">
  
  
    <meta name="description" content="One website for remembering the life i spend on coding">
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>
    
    Mien&#39;s Grown Diary</title>
  
    <link rel="shortcut icon" href="/favicon.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<script src="/js/pace.min.js"></script>

<meta name="generator" content="Hexo 5.0.0"></head>

<body>
<main class="content">
  <section class="jumbotron">
  <div class="video">
    
      <div class="video-frame">
        <img src="/images/ocean/overlay-hero.png" alt="Decorative image frame">
      </div>
    
    <div class="video-media">
      <video playsinline="" autoplay="" loop="" muted="" data-autoplay=""
             poster="/images/ocean/ocean.png" x5-video-player-type="h5">
        <source src="/images/ocean/ocean.mp4" type="video/mp4">
        <source src="/images/ocean/ocean.ogv" type="video/ogg">
        <source src="/images/ocean/ocean.webm" type="video/webm">
        <p>Your user agent does not support the HTML5 Video element.</p>
      </video>
      <div class="video-overlay"></div>
    </div>
    <div class="video-inner text-center text-white">
      <h1><a href="/">Mien&#39;s Grown Diary</a></h1>
      <p>Mien&#39;s Grown Diary</p>
      <div><img src="/images/hexo-inverted.svg" class="brand" alt="Mien&#39;s Grown Diary"></div>
    </div>
    <div class="video-learn-more">
      <a class="anchor" href="#landingpage"><i class="fe fe-mouse"></i></a>
    </div>
  </div>
</section>

<div id="landingpage">
  <section class="outer">
    <article class="articles">
      
      <h1 class="page-type-title"></h1>
      
        
          <article id="post-mien" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

    <div class="article-inner">
        
            <header class="article-header">
                
  
    <h2 itemprop="name">
      <a class="article-title" href="/2020/08/02/mien/">Mien&#39;s Grown Diary</a>
    </h2>
  
  




            </header>
            

                
                    <div class="article-meta">
                        <a href="/2020/08/02/mien/" class="article-date">
  <time datetime="2020-08-02T09:26:05.677Z" itemprop="datePublished">2020-08-02</time>
</a>
                            
                    </div>
                    

                        

                                    <div class="article-entry" itemprop="articleBody">
                                        


                                            

                                                
                                                                    <h3 id="let-make-a-better-life"><a href="#let-make-a-better-life" class="headerlink" title="let make a better life"></a>let make a better life</h3>
                                                                        
                                    </div>
                                    <footer class="article-footer">
                                        <a data-url="https://mienhuang.github.io/2020/08/02/mien/" data-id="ckdcw0uwk000420via3q1gysq" class="article-share-link">
                                            Share
                                        </a>
                                        
                                    </footer>

    </div>

    

                

</article>
        
          <article id="post-javascript-入学考试，来看看你到底需要在那些方面努力吧" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

    <div class="article-inner">
        
            <header class="article-header">
                
  
    <h2 itemprop="name">
      <a class="article-title" href="/2020/08/02/javascript-%E5%85%A5%E5%AD%A6%E8%80%83%E8%AF%95%EF%BC%8C%E6%9D%A5%E7%9C%8B%E7%9C%8B%E4%BD%A0%E5%88%B0%E5%BA%95%E9%9C%80%E8%A6%81%E5%9C%A8%E9%82%A3%E4%BA%9B%E6%96%B9%E9%9D%A2%E5%8A%AA%E5%8A%9B%E5%90%A7/">javascript 入学考试，来看看你到底需要在那些方面努力吧~</a>
    </h2>
  
  




            </header>
            

                
                    <div class="article-meta">
                        <a href="/2020/08/02/javascript-%E5%85%A5%E5%AD%A6%E8%80%83%E8%AF%95%EF%BC%8C%E6%9D%A5%E7%9C%8B%E7%9C%8B%E4%BD%A0%E5%88%B0%E5%BA%95%E9%9C%80%E8%A6%81%E5%9C%A8%E9%82%A3%E4%BA%9B%E6%96%B9%E9%9D%A2%E5%8A%AA%E5%8A%9B%E5%90%A7/" class="article-date">
  <time datetime="2020-08-02T09:19:23.000Z" itemprop="datePublished">2020-08-02</time>
</a>
                            
                    </div>
                    

                        

                                    <div class="article-entry" itemprop="articleBody">
                                        


                                            

                                                
                                                                    <blockquote>
<p>须知：每道题的完成时间最多1分钟。请自觉按照时间记录答案。</p>
</blockquote>
<p>下面一共有18道前端题目，每道题目限时1分钟（其实大部分题目限时少于1分钟），答对12道以上的同学视为优秀。</p>
<p>下面的题目为全英文题目，但是也只需要小学英语知识就足够了。</p>
<p>话不多说，直接开始吧~</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/7/11/1733e5f2fa06c7f7?w=225&h=225&f=png&s=31081"></p>
<h4 id="1-What-is-one-function-you-can-use-to-determine-whether-a-value-is-an-illegal-number-or-not"><a href="#1-What-is-one-function-you-can-use-to-determine-whether-a-value-is-an-illegal-number-or-not" class="headerlink" title="1. What is one function you can use to determine whether a value is an illegal number or not?"></a>1. What is one function you can use to determine whether a value is an illegal number or not?</h4><p>A: NaN()</p>
<p>B: isNaN()</p>
<p>C: isNumber()</p>
<p>D: parseFloat()</p>
<h4 id="2-The-following-function-never-prints-“bar”-to-the-console-despite-what-is-passed-into-the-function-Why"><a href="#2-The-following-function-never-prints-“bar”-to-the-console-despite-what-is-passed-into-the-function-Why" class="headerlink" title="2. The following function never prints “bar” to the console, despite what is passed into the function. Why?"></a>2. The following function never prints “bar” to the console, despite what is passed into the function. Why?</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (x = <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;foo&#x27;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (x == <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;bar&#x27;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;baz&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>A: The first condition expression overwrites <code>x</code>.</p>
<p>B: The second condition expression overwrites <code>x</code>.</p>
<p>C: <code>x</code> can never be false because it’s a function argument.</p>
<p>D: The first condition expression handles everything that the second would.</p>
<h4 id="3-What-primitive-type-is-the-variable-result"><a href="#3-What-primitive-type-is-the-variable-result" class="headerlink" title="3. What primitive type is the variable result?"></a>3. What primitive type is the variable <code>result</code>?</h4><p><code>const result = NaN</code></p>
<p>A: Number</p>
<p>B: Boolean</p>
<p>C: Symbol</p>
<p>D: String</p>
<h4 id="4-After-the-following-code-is-executed-what-is-printed-to-the-console"><a href="#4-After-the-following-code-is-executed-what-is-printed-to-the-console" class="headerlink" title="4. After the following code is executed, what is printed to the console?"></a>4. After the following code is executed, what is printed to the console?</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">list</span>(<span class="params"></span>) </span>&#123;  </span><br><span class="line">  <span class="keyword">return</span> [].slice.call(<span class="built_in">arguments</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> leadingThirtysevenList = list.bind(<span class="literal">null</span>, <span class="number">37</span>);</span><br><span class="line"><span class="keyword">var</span> list2 = leadingThirtysevenList();</span><br><span class="line"><span class="built_in">console</span>.log(list2);</span><br></pre></td></tr></table></figure>

<p>A: null</p>
<p>B: [37]</p>
<p>C: []</p>
<p>D: undefined</p>
<h4 id="5-How-would-you-instantiate-an-object-for-the-date-January-2-2000"><a href="#5-How-would-you-instantiate-an-object-for-the-date-January-2-2000" class="headerlink" title="5. How would you instantiate an object for the date January 2, 2000?"></a>5. How would you instantiate an object for the date January 2, 2000?</h4><p>A: <code>let d = new Date();</code> the internal representation of a date is the number of milliseconds since January 2, 2000</p>
<p>B: <code>let d = new Date(1, 2, 2000);</code></p>
<p>C: <code>let d = new Date(2000, 2, 1);</code></p>
<p>D: <code>let d = new Date(2000, 0, 2);</code></p>
<h4 id="6-Given-the-following"><a href="#6-Given-the-following" class="headerlink" title="6. Given the following:"></a>6. Given the following:</h4><p><code>console.log(iterator1.next().value); // [&quot;0&quot;, &quot;foo&quot;]</code></p>
<p>Which snippet will set up iterator1 for the above behavior?</p>
<p>A: <code>let map1 = new Map();const iterator1 = map1.entries();map1.set(&#39;0&#39;, &#39;foo&#39;);</code></p>
<p>B: <code>let map1 = new Map();const iterator1 = map1.keys();map1.set(&#39;0&#39;, &#39;foo&#39;);</code></p>
<p>C: <code>let map1 = Map();const iterator1 = map1.items();map1.set(&#39;0&#39;, &#39;foo&#39;);</code></p>
<p>D: <code>let map1 = new Map();const iterator1 = map1.get();map1.set(&#39;0&#39;, &#39;foo&#39;);</code></p>
<h4 id="7-What-static-method-defines-setters-getters-and-other-configurations-for-a-new-or-existing-property-on-an-object"><a href="#7-What-static-method-defines-setters-getters-and-other-configurations-for-a-new-or-existing-property-on-an-object" class="headerlink" title="7. What static method defines setters, getters, and other configurations for a new or existing property on an object?"></a>7. What static method defines setters, getters, and other configurations for a new or existing property on an object?</h4><p>A: <code>Object[&quot;setProperty&quot;]()</code></p>
<p>B: <code>Object.prototype.Property()</code></p>
<p>C: <code>Property.declare()</code></p>
<p>D: <code>Object.defineProperty()</code></p>
<h4 id="8-Given-a-complex-object-foo-with-keys-that-are-not-known-ahead-of-time-how-can-you-check-if-a-given-key-“k”-is-in-the-object-without-iterating-through-the-whole-object"><a href="#8-Given-a-complex-object-foo-with-keys-that-are-not-known-ahead-of-time-how-can-you-check-if-a-given-key-“k”-is-in-the-object-without-iterating-through-the-whole-object" class="headerlink" title="8. Given a complex object, foo, with keys that are not known ahead of time, how can you check if a given key, “k”, is in the object without iterating through the whole object?"></a>8. Given a complex object, foo, with keys that are not known ahead of time, how can you check if a given key, “k”, is in the object without iterating through the whole object?</h4><p>A: <code>...foo == k</code></p>
<p>B: <code>foo contains k</code></p>
<p>C: <code>&quot;k&quot; in foo</code></p>
<p>D: <code>foo.apply(k)</code></p>
<h4 id="9-Given-that-the-sine-of-90-degrees-is-1-what-is-the-result-of-the-code-below-let-foo-Math-sin-90"><a href="#9-Given-that-the-sine-of-90-degrees-is-1-what-is-the-result-of-the-code-below-let-foo-Math-sin-90" class="headerlink" title="9. Given that the sine of 90 degrees is 1, what is the result of the code below?let foo = Math.sin(90);"></a>9. Given that the sine of 90 degrees is 1, what is the result of the code below?<code>let foo = Math.sin(90);</code></h4><p>A: <code>1</code></p>
<p>B: A ReferenceError will be thrown; the trigonometry functions are meant to be called at a global scope:<code>let foo = sin(90)</code></p>
<p>C: A ValueError will be thrown; <code>Math.sin()</code> expects a second argument specifying degrees or radians</p>
<p>D: Not 1, because <code>Math.sin()</code> expects the parameter to be in radians</p>
<h4 id="10-What-happens-when-an-object-inherits-from-another-object-using-Object-create"><a href="#10-What-happens-when-an-object-inherits-from-another-object-using-Object-create" class="headerlink" title="10. What happens when an object inherits from another object using Object.create()?"></a>10. What happens when an object inherits from another object using <code>Object.create()</code>?</h4><p>A: A copy of the old object is created, and the constructor is used to construct the new object.</p>
<p>B: The prototype chain for the original object is given to the new object, giving a reference of and access to all of the original object properties.</p>
<p>C: One by one, the object’s properties are copied over to the new object.</p>
<p>D: The new object is given a reference to the original object’s constructor, which allows the new object to create a new prototype chain.</p>
<h4 id="11-How-can-you-remove-all-of-the-items-within-an-array"><a href="#11-How-can-you-remove-all-of-the-items-within-an-array" class="headerlink" title="11. How can you remove all of the items within an array?"></a>11. How can you remove all of the items within an array?</h4><p>A: <code>let arr = [‘hello’, ‘world’]; arr.length = 0;</code></p>
<p>B: <code>var arr = [‘hello’, ‘world’]; arr.empty();</code></p>
<p>C: <code>var arr = [‘hello’, ‘world’]; arr.remove(2);</code></p>
<p>D: <code>var arr = [‘hello’, ‘world’]; arr.toShortList();</code></p>
<h4 id="12-What-is-wrong-with-this-snippet"><a href="#12-What-is-wrong-with-this-snippet" class="headerlink" title="12. What is wrong with this snippet?"></a>12. What is wrong with this snippet?</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MegaArray</span> <span class="keyword">extends</span> <span class="title">Array</span></span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(contents)&#123;</span><br><span class="line">    <span class="built_in">this</span>.contents = contents;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> mArr = <span class="keyword">new</span> MegaArray(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br></pre></td></tr></table></figure>

<p>A: The class constructor does not call <code>parent()</code>.</p>
<p>B: Classes both cannot inherit built-in types and must pass constructor arguments to the parent’s constructor using <code>super()</code>.</p>
<p>C: The class constructor does not call <code>super()</code>, so <code>this</code> is not defined when inheriting from <code>Array</code>.</p>
<p>D: Classes cannot inherit from built-in types.</p>
<h4 id="13-Which-code-snippet-correctly-shows-unpacking-the-arguments-object-into-an-array"><a href="#13-Which-code-snippet-correctly-shows-unpacking-the-arguments-object-into-an-array" class="headerlink" title="13. Which code snippet correctly shows unpacking the arguments object into an array?"></a>13. Which code snippet correctly shows unpacking the arguments object into an array?</h4><p>A: <code>Array.toArray(arguments)</code></p>
<p>B: <code>[arguments]</code></p>
<p>C: <code>arguments.toArray()</code></p>
<p>D: <code>Array.from(arguments)</code></p>
<h4 id="14-The-following-snippet-throws-an-error-Why"><a href="#14-The-following-snippet-throws-an-error-Why" class="headerlink" title="14. The following snippet throws an error. Why?"></a>14. The following snippet throws an error. Why?</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">  &#x27;use strict&#x27;</span>;</span><br><span class="line">  (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> point = &#123;<span class="attr">x</span>: <span class="number">42</span>, <span class="attr">y</span>: <span class="number">27</span>&#125;;</span><br><span class="line">    <span class="keyword">with</span> (point) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;The coordinates are: x: &#x27;</span>, x, <span class="string">&#x27;y: &#x27;</span>, y);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)();</span><br><span class="line">&#125;</span><br><span class="line">foo();</span><br></pre></td></tr></table></figure>

<p>A: You cannot use immediately invoked function expressions (IIFEs) in strict mode</p>
<p>B: You cannot add the <code>&#39;use strict&#39;</code>; directive in a function</p>
<p>C: You cannot declare object literals in strict mode</p>
<p>D: You cannot use <code>with</code> statements in strict mode</p>
<h4 id="15-When-inheriting-from-a-parent-class-what-does-the-super-keyword-do-in-the-child’s-constructor"><a href="#15-When-inheriting-from-a-parent-class-what-does-the-super-keyword-do-in-the-child’s-constructor" class="headerlink" title="15. When inheriting from a parent class, what does the super keyword do in the child’s constructor?"></a>15. When inheriting from a parent class, what does the <code>super</code> keyword do in the child’s constructor?</h4><p>A: <code>super</code> invokes the parent’s constructor, and by extension, defines the lexical context and this object for the child class.</p>
<p>B: <code>super</code> instantiates the parent class and deep copies the properties over to the child class.</p>
<p>C: <code>super</code> invokes the parent constructor, and then performs a deep copy of the parent properties over to the child class to make a wholly new object.</p>
<p>D: <code>super</code> instantiates the parent class and copies the properties over as virtual properties on the child class.</p>
<h4 id="16-What-does-this-print-to-the-console-and-why"><a href="#16-What-does-this-print-to-the-console-and-why" class="headerlink" title="16. What does this print to the console and why?"></a>16. What does this print to the console and why?</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Foo</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Bar</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">Bar.prototype = <span class="built_in">Object</span>.create(Foo.prototype);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> banana = <span class="keyword">new</span> Bar();</span><br><span class="line"><span class="keyword">let</span> apple = <span class="keyword">new</span> Foo();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(Bar.prototype.isPrototypeOf(apple));</span><br><span class="line"><span class="built_in">console</span>.log(Bar.prototype.isPrototypeOf(banana));</span><br><span class="line"><span class="built_in">console</span>.log(Foo.prototype.isPrototypeOf(banana));</span><br></pre></td></tr></table></figure>

<p>A: <code>ReferenceError</code> will be thrown</p>
<p>B: <code>true</code>, <code>true</code>, <code>true</code></p>
<p>C: <code>true</code>, <code>true</code>, <code>false</code></p>
<p>D:  <code>false</code>, <code>true</code>, <code>true</code></p>
<h4 id="17-What-is-printed-to-the-console-in-the-following-code-snippet"><a href="#17-What-is-printed-to-the-console-in-the-following-code-snippet" class="headerlink" title="17. What is printed to the console in the following code snippet?"></a>17. What is printed to the console in the following code snippet?</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> foo = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;User1&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> bar = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;User2&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> x = <span class="literal">false</span> || bar() || foo();</span><br></pre></td></tr></table></figure>

<p>A: <code>undefined</code></p>
<p>B: <code>User2</code> <code>User1</code></p>
<p>C: <code>User1</code> <code>User2</code></p>
<p>D: <code>User2</code></p>
<h4 id="18-After-the-following-code-is-executed-what-is-printed-to-the-console"><a href="#18-After-the-following-code-is-executed-what-is-printed-to-the-console" class="headerlink" title="18. After the following code is executed, what is printed to the console?"></a>18. After the following code is executed, what is printed to the console?</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> map1 = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">map1.set(<span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;foo&#x27;</span>);</span><br><span class="line">map1.set(<span class="number">1</span>, <span class="string">&#x27;bar&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> iterator1 = map1.entries();</span><br><span class="line"><span class="built_in">console</span>.log(iterator1.next().value);</span><br></pre></td></tr></table></figure>

<p>A: <code>&quot;0&quot;</code></p>
<p>B: <code>&quot;foo&quot;</code></p>
<p>C: <code>[&quot;0&quot;, &quot;foo&quot;]</code></p>
<p>D: <code>[&quot;foo&quot;]</code></p>
<p>各位同学，上面的题目怎么样是不是很简单啊~</p>
<p>下面公布答案：</p>
<p>BAABD ADCDB ACDDA DD</p>
<p>你答对了多少呢？</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/7/11/1733e5e90e78fe54?w=300&h=225&f=png&s=32948"></p>
<p>请按照时间要求，自觉答题，并把你的分数写在评论里吧~</p>
<p>欢迎讨论问题！</p>

                                                                        
                                    </div>
                                    <footer class="article-footer">
                                        <a data-url="https://mienhuang.github.io/2020/08/02/javascript-%E5%85%A5%E5%AD%A6%E8%80%83%E8%AF%95%EF%BC%8C%E6%9D%A5%E7%9C%8B%E7%9C%8B%E4%BD%A0%E5%88%B0%E5%BA%95%E9%9C%80%E8%A6%81%E5%9C%A8%E9%82%A3%E4%BA%9B%E6%96%B9%E9%9D%A2%E5%8A%AA%E5%8A%9B%E5%90%A7/" data-id="ckdcw0uwc000320vi66w3adys" class="article-share-link">
                                            Share
                                        </a>
                                        
                                    </footer>

    </div>

    

                

</article>
        
          <article id="post-Angular-微前端实践-之-Single-SPA-手把手教程（上）" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

    <div class="article-inner">
        
            <header class="article-header">
                
  
    <h2 itemprop="name">
      <a class="article-title" href="/2020/08/02/Angular-%E5%BE%AE%E5%89%8D%E7%AB%AF%E5%AE%9E%E8%B7%B5-%E4%B9%8B-Single-SPA-%E6%89%8B%E6%8A%8A%E6%89%8B%E6%95%99%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/">Angular 微前端实践 之 Single-SPA 手把手教程（上）</a>
    </h2>
  
  




            </header>
            

                
                    <div class="article-meta">
                        <a href="/2020/08/02/Angular-%E5%BE%AE%E5%89%8D%E7%AB%AF%E5%AE%9E%E8%B7%B5-%E4%B9%8B-Single-SPA-%E6%89%8B%E6%8A%8A%E6%89%8B%E6%95%99%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/" class="article-date">
  <time datetime="2020-08-02T09:18:42.000Z" itemprop="datePublished">2020-08-02</time>
</a>
                            
                    </div>
                    

                        

                                    <div class="article-entry" itemprop="articleBody">
                                        


                                            

                                                
                                                                    <blockquote>
<p>最近自己在研究Angular的微前端实践，算是比较完整的从零走通了整个流程。了解到很多小伙伴也有这方面的需求，所以整理了一些内容希望对各位小伙伴有帮助。</p>
</blockquote>
<p>各位看官时间有限，我们直接进入正题。</p>
<h3 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h3><ul>
<li>一个container项目，两个微前端项目</li>
<li>container项目的展示页面同时加载两个项目</li>
<li>不同项目之间，资源抽离，减小加载资源量</li>
</ul>
<h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><ul>
<li>node -v 10.16.3</li>
<li>npm -v 6.9.0 </li>
<li>angular -v 8.2.11</li>
<li>VS code</li>
</ul>
<h3 id="项目准备"><a href="#项目准备" class="headerlink" title="项目准备"></a>项目准备</h3><ul>
<li>确认本地安装Angular-cli</li>
<li>使用命令 <code>ng new project --prefix=prefix</code>创建三个项目</li>
<li>微前端的项目最好使用不同的prefix这样在加载项目的时候才不会出错。</li>
</ul>
<p>本示例中执行的命令如下：</p>
<ul>
<li><code>ng new container --prefix=slb</code></li>
<li><code>ng new app1 --prefix=app1</code></li>
<li><code>ng new app2 --prefix=app2</code></li>
</ul>
<h3 id="container部分"><a href="#container部分" class="headerlink" title="container部分"></a>container部分</h3><h4 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h4><ul>
<li><code>npm i single-spa --save</code></li>
<li><code>npm i systemjs --save</code></li>
<li><code>npm i import-map-overrides --save</code></li>
</ul>
<h4 id="修改angular-json"><a href="#修改angular-json" class="headerlink" title="修改angular.json"></a>修改angular.json</h4><p>将build下的scripts修改如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;node_modules/systemjs/dist/system.min.js&quot;</span>,</span><br><span class="line">    <span class="string">&quot;node_modules/systemjs/dist/extras/amd.min.js&quot;</span>,</span><br><span class="line">    <span class="string">&quot;node_modules/systemjs/dist/extras/named-exports.min.js&quot;</span>,</span><br><span class="line">    <span class="string">&quot;node_modules/systemjs/dist/extras/named-register.min.js&quot;</span>,</span><br><span class="line">    <span class="string">&quot;node_modules/import-map-overrides/dist/import-map-overrides.js&quot;</span></span><br><span class="line">    ]</span><br></pre></td></tr></table></figure>

<p>以上我们就完成了container项目的配置工作，下面开始进入代码环节。</p>
<h4 id="修改index-html"><a href="#修改index-html" class="headerlink" title="修改index.html"></a>修改index.html</h4><p>在head标签下增加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta name&#x3D;&quot;importmap-type&quot; content&#x3D;&quot;systemjs-importmap&quot; &#x2F;&gt;</span><br><span class="line">&lt;script type&#x3D;&quot;systemjs-importmap&quot; src&#x3D;&quot;&#x2F;assets&#x2F;import-map.json&quot;&gt;&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<p>在body标签下增加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;import-map-overrides-full&gt;&lt;&#x2F;import-map-overrides-full&gt;</span><br></pre></td></tr></table></figure>

<p>index.html 最终内容如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Container<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">base</span> <span class="attr">href</span>=<span class="string">&quot;/&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;importmap-type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;systemjs-importmap&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">type</span>=<span class="string">&quot;image/x-icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;favicon.ico&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;systemjs-importmap&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/assets/import-map.json&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slb-root</span>&gt;</span><span class="tag">&lt;/<span class="name">slb-root</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">import-map-overrides-full</span>&gt;</span><span class="tag">&lt;/<span class="name">import-map-overrides-full</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>细心的小伙伴可能会注意到为我们引入了一个还没有创建的文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type&#x3D;&quot;systemjs-importmap&quot; src&#x3D;&quot;&#x2F;assets&#x2F;import-map.json&quot;&gt;&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>

<p>就是上面这行代码中的JSON文件。那么下一步我们就来创建这个文件。</p>
<h4 id="创建微前端项目索引文件"><a href="#创建微前端项目索引文件" class="headerlink" title="创建微前端项目索引文件"></a>创建微前端项目索引文件</h4><p>在assets目录下新建import-map.json文件，内容如下。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;imports&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;app1&quot;</span>: <span class="string">&quot;http://localhost:4201/main.js&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;app2&quot;</span>: <span class="string">&quot;http://localhost:4202/main.js&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br></pre></td></tr></table></figure>
<p>在demo中我们都是本地服务加载这些文件，所以这里的地址都是<code>localhost</code>。<code>4201</code>和<code>4202</code>分别是两个微前端项目的端口。</p>
<h4 id="创建spa-host-component"><a href="#创建spa-host-component" class="headerlink" title="创建spa-host component"></a>创建spa-host component</h4><p>执行<code>ng g c spa-host</code></p>
<p>angular-cli 会帮助我们创建一个spa-host component。这个组件会是我们挂载微前端的地方。</p>
<h4 id="修改spa-host-component"><a href="#修改spa-host-component" class="headerlink" title="修改spa-host component"></a>修改spa-host component</h4><h5 id="spa-host-component-html"><a href="#spa-host-component-html" class="headerlink" title="spa-host.component.html"></a>spa-host.component.html</h5><p>在html 页面创建两个挂载元素。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> #<span class="attr">app1</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> #<span class="attr">app2</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>挂载点的数量与我们需要挂载的微前端个数一致，在当前demo中我们需要挂载两个项目，分别为app1和app2。</p>
<h5 id="spa-host-component-ts"><a href="#spa-host-component-ts" class="headerlink" title="spa-host.component.ts"></a>spa-host.component.ts</h5><p>先获取挂载点:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ViewChild</span>(<span class="string">&#x27;app1&#x27;</span>, &#123; <span class="keyword">static</span>: <span class="literal">true</span> &#125;) <span class="keyword">private</span> app1: ElementRef;</span><br><span class="line"><span class="meta">@ViewChild</span>(<span class="string">&#x27;app2&#x27;</span>, &#123; <span class="keyword">static</span>: <span class="literal">true</span> &#125;) <span class="keyword">private</span> app2: ElementRef;</span><br></pre></td></tr></table></figure>

<p>为了上述代码能够运行，我们需要引入依赖。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Component, OnInit, ViewChild, ElementRef, OnDestroy &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>在获取挂载点之后，我们就可以将另外的两个前端项目进行挂在了。</p>
<p>接下来我们需要一个方法来挂载项目。</p>
<h4 id="创建微前端挂载函数"><a href="#创建微前端挂载函数" class="headerlink" title="创建微前端挂载函数"></a>创建微前端挂载函数</h4><p>在src下创建service文件夹</p>
<p>创建 <code>single-spa.service.ts</code></p>
<p>在这里service中我们需要两个方法，一个是挂载，一个是卸载。</p>
<p>所以这个service的核心方法只有 <code>mount</code> 和 <code>unmount</code>。</p>
<p>这里项目的挂载我们需要依赖<code>single-spa</code>提供的<code>mountRootParcel</code>方法来实现。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mountRootParcel(app, &#123; domElement &#125;);</span><br></pre></td></tr></table></figure>
<p>这个方法接受两个参数，第一个是需要挂载的项目，第二个是一个options,为我们需要传的就是这个domElement,也就是我们的挂载点。</p>
<p>这个方法会返回一个挂载的Parcel 对象，内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">type Parcel &#x3D; &#123;</span><br><span class="line">  mount(): Promise&lt;null&gt;;</span><br><span class="line">  unmount(): Promise&lt;null&gt;;</span><br><span class="line">  update(customProps: object): Promise&lt;any&gt;;</span><br><span class="line">  getStatus():</span><br><span class="line">    | &quot;NOT_LOADED&quot;</span><br><span class="line">    | &quot;LOADING_SOURCE_CODE&quot;</span><br><span class="line">    | &quot;NOT_BOOTSTRAPPED&quot;</span><br><span class="line">    | &quot;BOOTSTRAPPING&quot;</span><br><span class="line">    | &quot;NOT_MOUNTED&quot;</span><br><span class="line">    | &quot;MOUNTING&quot;</span><br><span class="line">    | &quot;MOUNTED&quot;</span><br><span class="line">    | &quot;UPDATING&quot;</span><br><span class="line">    | &quot;UNMOUNTING&quot;</span><br><span class="line">    | &quot;UNLOADING&quot;</span><br><span class="line">    | &quot;SKIP_BECAUSE_BROKEN&quot;</span><br><span class="line">    | &quot;LOAD_ERROR&quot;;</span><br><span class="line">  loadPromise: Promise&lt;null&gt;;</span><br><span class="line">  bootstrapPromise: Promise&lt;null&gt;;</span><br><span class="line">  mountPromise: Promise&lt;null&gt;;</span><br><span class="line">  unmountPromise: Promise&lt;null&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>从这里我们可以发现，Parcel是我们卸载app的依据。</p>
<p>所以我们在卸载应用的时候需要执行的就是<code>Parcel.unmount()</code>;</p>
<p>到这里我们基本清楚我们的挂载和卸载的实现了，下面上代码：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Injectable &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Parcel, mountRootParcel,  &#125; <span class="keyword">from</span> <span class="string">&#x27;single-spa&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Observable, <span class="keyword">from</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; mapTo, tap &#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs/operators&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>(&#123;</span><br><span class="line">  providedIn: <span class="string">&#x27;root&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> SingleSpaService &#123;</span><br><span class="line">  <span class="keyword">private</span> loadedParcels: &#123;</span><br><span class="line">    [appName: <span class="built_in">string</span>]: Parcel</span><br><span class="line">  &#125; = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params"></span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line">  mount(appName: <span class="built_in">string</span>, domElement: HTMLElement): Observable&lt;<span class="built_in">void</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">from</span>(<span class="built_in">window</span>.System.import(appName))</span><br><span class="line">      .pipe(</span><br><span class="line">        tap(<span class="function"><span class="params">app</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">this</span>.loadedParcels[appName] = mountRootParcel(app, &#123; domElement &#125;);</span><br><span class="line">        &#125;),</span><br><span class="line">        mapTo(<span class="literal">null</span>)</span><br><span class="line">      );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  unmount(appName: <span class="built_in">string</span>): Observable&lt;<span class="built_in">void</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">from</span>(<span class="built_in">this</span>.loadedParcels[appName].unmount()).pipe(</span><br><span class="line">      tap(<span class="function">() =&gt;</span> <span class="keyword">delete</span> <span class="built_in">this</span>.loadedParcels[appName]),</span><br><span class="line">      mapTo(<span class="literal">null</span>)</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在上面的代码中我们使用了Window.System.import 方法，但是我们在运行的时候会发现，在window下并不存在System这个对象。</p>
<p>其实这个对象是有的，只是没有被lint 出来而已，但是我们还是有办法解决这个难看的报错的。</p>
<p>src目录下新建一个types文件夹，然后创建ambient.d.ts文件，当然换一个你自己喜欢的名字也可以。</p>
<p>内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import &#123; ParcelConfig &#125; from &#39;single-spa&#39;;</span><br><span class="line"></span><br><span class="line">declare global &#123;</span><br><span class="line">  interface Window &#123;</span><br><span class="line">    System: &#123;</span><br><span class="line">      import: (app: string) &#x3D;&gt; Promise&lt;ParcelConfig&gt;;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这样，我们就不会有报错了。</p>
<p>tips:</p>
<p><code>loadedParcels</code> 是我们存储已经挂载的应用的变量。</p>
<p>创建完成 <code>single-spa</code> service之后我们回到 <code>spa-host</code>组件来完成我们页面的挂载和卸载。</p>
<h5 id="spa-host-component-ts-1"><a href="#spa-host-component-ts-1" class="headerlink" title="spa-host.component.ts"></a>spa-host.component.ts</h5><h5 id="实例化spa-service"><a href="#实例化spa-service" class="headerlink" title="实例化spa-service"></a>实例化spa-service</h5><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">constructor</span>(<span class="params"><span class="keyword">private</span> service: SingleSpaService</span>) &#123; &#125;</span><br></pre></td></tr></table></figure>

<h5 id="挂载"><a href="#挂载" class="headerlink" title="挂载"></a>挂载</h5><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.service.mount(<span class="string">&#x27;app1&#x27;</span>, <span class="built_in">this</span>.app1.nativeElement).subscribe();</span><br><span class="line"><span class="built_in">this</span>.service.mount(<span class="string">&#x27;app2&#x27;</span>, <span class="built_in">this</span>.app2.nativeElement).subscribe();</span><br></pre></td></tr></table></figure>

<p>在我们的demo 中，因为是假的项目和固定的挂载数目，所以我将挂载方法写在了<code>onInit</code> 方法内，但是在实际的项目中挂载方法的执行应该是在你获取到数据之后。</p>
<h5 id="卸载"><a href="#卸载" class="headerlink" title="卸载"></a>卸载</h5><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">zip(</span><br><span class="line">    <span class="built_in">this</span>.service.unmount(<span class="string">&#x27;app1&#x27;</span>),</span><br><span class="line">    <span class="built_in">this</span>.service.unmount(<span class="string">&#x27;app2&#x27;</span>)</span><br><span class="line">).toPromise();</span><br></pre></td></tr></table></figure>

<p>关于卸载的处理如果项目是挂载一次的，那么都应该在<code>onDestory</code> 的时候统一卸载所有挂载应用。如果是页面动态变化的，那么卸载也会发生在<code>onChange</code>的时候。</p>
<h4 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Component, OnInit, ViewChild, ElementRef, OnDestroy &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; SingleSpaService &#125; <span class="keyword">from</span> <span class="string">&#x27;../../service/single-spa.service&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; zip &#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  selector: <span class="string">&#x27;slb-spa-host&#x27;</span>,</span><br><span class="line">  templateUrl: <span class="string">&#x27;./spa-host.component.html&#x27;</span>,</span><br><span class="line">  styleUrls: [<span class="string">&#x27;./spa-host.component.scss&#x27;</span>]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> SpaHostComponent <span class="keyword">implements</span> OnInit, OnDestroy &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params"><span class="keyword">private</span> service: SingleSpaService</span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@ViewChild</span>(<span class="string">&#x27;app1&#x27;</span>, &#123; <span class="keyword">static</span>: <span class="literal">true</span> &#125;) <span class="keyword">private</span> app1: ElementRef;</span><br><span class="line">  <span class="meta">@ViewChild</span>(<span class="string">&#x27;app2&#x27;</span>, &#123; <span class="keyword">static</span>: <span class="literal">true</span> &#125;) <span class="keyword">private</span> app2: ElementRef;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  ngOnInit() &#123;</span><br><span class="line">    <span class="built_in">this</span>.service.mount(<span class="string">&#x27;app1&#x27;</span>, <span class="built_in">this</span>.app1.nativeElement).subscribe();</span><br><span class="line">    <span class="built_in">this</span>.service.mount(<span class="string">&#x27;app2&#x27;</span>, <span class="built_in">this</span>.app2.nativeElement).subscribe();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> ngOnDestroy() &#123;</span><br><span class="line">    <span class="keyword">await</span> zip(</span><br><span class="line">      <span class="built_in">this</span>.service.unmount(<span class="string">&#x27;app1&#x27;</span>),</span><br><span class="line">      <span class="built_in">this</span>.service.unmount(<span class="string">&#x27;app2&#x27;</span>)</span><br><span class="line">    ).toPromise();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>至此，我们就做完了<code>spa-host</code> component 的全部改动。</p>
<p>我们既然已经创建完这个component，接下来当然是让它起作用。</p>
<h4 id="查看app-module-ts"><a href="#查看app-module-ts" class="headerlink" title="查看app.module.ts"></a>查看app.module.ts</h4><p>确认 <code>SpaHostComponent</code>已经被引入并声明完成。如果没有那就手动完成一下。</p>
<p>引入component</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &#123; SpaHostComponent &#125; from &#39;.&#x2F;spa-host&#x2F;spa-host.component&#39;;</span><br></pre></td></tr></table></figure>

<p>加到declarations 中</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">declarations: [</span><br><span class="line">  AppComponent,</span><br><span class="line">  SpaHostComponent</span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<p>完整代码：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; BrowserModule &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/platform-browser&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; NgModule &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; AppRoutingModule &#125; <span class="keyword">from</span> <span class="string">&#x27;./app-routing.module&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; AppComponent &#125; <span class="keyword">from</span> <span class="string">&#x27;./app.component&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; SpaHostComponent &#125; <span class="keyword">from</span> <span class="string">&#x27;./spa-host/spa-host.component&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NgModule</span>(&#123;</span><br><span class="line">  declarations: [</span><br><span class="line">    AppComponent,</span><br><span class="line">    SpaHostComponent</span><br><span class="line">  ],</span><br><span class="line">  imports: [</span><br><span class="line">    BrowserModule,</span><br><span class="line">    AppRoutingModule</span><br><span class="line">  ],</span><br><span class="line">  providers: [</span><br><span class="line">  ],</span><br><span class="line">  bootstrap: [AppComponent]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppModule &#123; &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="修改路由"><a href="#修改路由" class="headerlink" title="修改路由"></a>修改路由</h4><p>将<code>SpaHostComponent</code>挂在跟路由下</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> routes: Routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    component: SpaHostComponent</span><br><span class="line">  &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p>完整代码</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; NgModule &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Routes, RouterModule &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; SpaHostComponent &#125; <span class="keyword">from</span> <span class="string">&#x27;./spa-host/spa-host.component&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes: Routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    component: SpaHostComponent</span><br><span class="line">  &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="meta">@NgModule</span>(&#123;</span><br><span class="line">  imports: [RouterModule.forRoot(routes)],</span><br><span class="line">  <span class="built_in">exports</span>: [RouterModule]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppRoutingModule &#123; &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="app-component-html"><a href="#app-component-html" class="headerlink" title="app.component.html"></a>app.component.html</h4><p>删除默认添加的内容只剩余<code>router-outlet</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">router-outlet</span>&gt;</span><span class="tag">&lt;/<span class="name">router-outlet</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="main-js启动single-spa"><a href="#main-js启动single-spa" class="headerlink" title="main.js启动single-spa"></a>main.js启动single-spa</h4><p>在main.js 中添加下列代码，启动single-spa</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> singleSpa <span class="keyword">from</span> <span class="string">&#x27;single-spa&#x27;</span>;</span><br><span class="line"></span><br><span class="line">singleSpa.start();</span><br></pre></td></tr></table></figure>

<p>上面就是全部的container 项目的改动了。</p>
<h3 id="微前端部分"><a href="#微前端部分" class="headerlink" title="微前端部分"></a>微前端部分</h3><p>下面我们开始修改微前端项目。在我们demo 里面两个微前端项目是完全相同的，所以下面我们以app1来举例。</p>
<h4 id="加载single-spa"><a href="#加载single-spa" class="headerlink" title="加载single-spa"></a>加载single-spa</h4><p>执行命令<br><code>ng add single-spa-angular</code></p>
<p>这条命令会帮我们完成一下内容</p>
<ul>
<li>安装 <code>single-spa-angular</code></li>
<li>创建 <code>src/main.single-spa.ts</code></li>
<li>创建 <code>src/single-spa/single-spa-props.ts</code></li>
<li>创建 <code>src/single-spa/asset-url.ts</code></li>
<li>创建 <code>EmptyRouteComponent</code>并引入到<code>app-routing.module.ts</code></li>
<li>增加npm script <code>build:single-spa</code> 和 <code>serve:single-spa</code></li>
<li>创建 <code>extra-webpack.config.js</code></li>
</ul>
<p><code>tips</code></p>
<p>关于webpack config这部分Angular 的7以及之前版本和8+的处理上不同。</p>
<h4 id="修改端口"><a href="#修改端口" class="headerlink" title="修改端口"></a>修改端口</h4><p>上面的命令增加了两个npm script, 但是里面的端口号是默认的4200，我们需要修改为我们真正使用的。这里4200是我们的container的端口号，所以这里我们使用4201.</p>
<p>将这两个脚本修改为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;build:single-spa&quot;: &quot;ng build --prod --deploy-url http:&#x2F;&#x2F;localhost:4201&#x2F;&quot;,</span><br><span class="line">&quot;serve:single-spa&quot;: &quot;ng serve --disable-host-check --port 4201 --deploy-url http:&#x2F;&#x2F;localhost:4201&#x2F; --live-reload false&quot;,</span><br></pre></td></tr></table></figure>

<h4 id="修改路由-1"><a href="#修改路由-1" class="headerlink" title="修改路由"></a>修改路由</h4><p>将路由指向我们创建的<code>EmptyRouteComponent</code>,修改路由为如下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const routes: Routes &#x3D; [</span><br><span class="line">  &#123;</span><br><span class="line">    path: &#39;**&#39;,</span><br><span class="line">    component: EmptyRouteComponent</span><br><span class="line">  &#125;</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p>providers 修改为如下</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">providers: [&#123; provide: APP_BASE_HREF, useValue: <span class="string">&#x27;/&#x27;</span> &#125;]</span><br></pre></td></tr></table></figure>

<p>完整代码：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; NgModule &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Routes, RouterModule &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; APP_BASE_HREF &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/common&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; EmptyRouteComponent &#125; <span class="keyword">from</span> <span class="string">&#x27;./empty-route/empty-route.component&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes: Routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;**&#x27;</span>,</span><br><span class="line">    component: EmptyRouteComponent</span><br><span class="line">  &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="meta">@NgModule</span>(&#123;</span><br><span class="line">  imports: [RouterModule.forRoot(routes)],</span><br><span class="line">  <span class="built_in">exports</span>: [RouterModule],</span><br><span class="line">  providers: [&#123; provide: APP_BASE_HREF, useValue: <span class="string">&#x27;/&#x27;</span> &#125;]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppRoutingModule &#123; &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="修改app-component-html"><a href="#修改app-component-html" class="headerlink" title="修改app.component.html"></a>修改app.component.html</h4><p>最后，我们修改一下<code>app.component.html</code>，删除之前的内容。</p>
<p>修改为</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Mien&#x27;s first Micro Front-end project<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这就是为前端部分的全部改动。同样的我们需要对app2也做同样的修改。</p>
<p>然后让我们运行一下看看吧~</p>
<p>告诉我，你也看到了下面的内容对吗？</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/3/14/170d92003934c236?w=822&h=421&f=jpeg&s=37789"></p>
<h3 id="写在后面"><a href="#写在后面" class="headerlink" title="写在后面"></a>写在后面</h3><p>以上便是<strong>Angular 微前端实践 之 Single-SPA 手把手教程（上）</strong> 的全部内容的，本文的下半部分还在整理中，如果感兴趣的话请评论告诉我。</p>
<p>对本文中的问题，也欢迎留言提问。</p>
<p>如有错误，欢迎指正。</p>
<h4 id="下半部分预告（计划）"><a href="#下半部分预告（计划）" class="headerlink" title="下半部分预告（计划）"></a>下半部分预告（计划）</h4><ul>
<li>路由处理</li>
<li>依赖抽离</li>
<li>动态挂载</li>
<li>SPA功能实现分析</li>
<li>问题回答</li>
</ul>
<p>另外还有不使用single-spa 的微前端实现，如果这些有人看就再整理一篇文章。</p>
<blockquote>
<p>第一次在掘金发文章，希望小伙伴们多多支持啊。</p>
</blockquote>

                                                                        
                                    </div>
                                    <footer class="article-footer">
                                        <a data-url="https://mienhuang.github.io/2020/08/02/Angular-%E5%BE%AE%E5%89%8D%E7%AB%AF%E5%AE%9E%E8%B7%B5-%E4%B9%8B-Single-SPA-%E6%89%8B%E6%8A%8A%E6%89%8B%E6%95%99%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89/" data-id="ckdcw0uwb000220viaykx09b0" class="article-share-link">
                                            Share
                                        </a>
                                        
                                    </footer>

    </div>

    

                

</article>
        
          <article id="post-Angular-PWA-入坑指北" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

    <div class="article-inner">
        
            <header class="article-header">
                
  
    <h2 itemprop="name">
      <a class="article-title" href="/2020/08/02/Angular-PWA-%E5%85%A5%E5%9D%91%E6%8C%87%E5%8C%97/">Angular PWA 入坑指北</a>
    </h2>
  
  




            </header>
            

                
                    <div class="article-meta">
                        <a href="/2020/08/02/Angular-PWA-%E5%85%A5%E5%9D%91%E6%8C%87%E5%8C%97/" class="article-date">
  <time datetime="2020-08-02T09:18:00.000Z" itemprop="datePublished">2020-08-02</time>
</a>
                            
                    </div>
                    

                        

                                    <div class="article-entry" itemprop="articleBody">
                                        


                                            

                                                
                                                                    <blockquote>
<p>hello，各位小伙伴大家好啊，这篇文章终于是在我拖的不能在拖的情况下，更了出来。在这里十分感谢那些不辞辛苦提醒我更新文章的小伙伴。愿你们在新的一年里，远离病毒，远离降薪，远离加班，升职加薪与你们同在，阿门~</p>
</blockquote>
<p>今天我们来水一篇文章，至于为什么说水一篇文章呢，因为关于PWA入门的基础教程其实网上是有很多的，大厂的系统教程也是有的，这里我们推荐两个。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://codelabs.developers.google.com/codelabs/your-first-pwapp/#0">Your First Progressive Web App</a></li>
<li><a target="_blank" rel="noopener" href="https://angular.io/guide/service-worker-intro">Service Worker &amp; PWA</a></li>
</ul>
<p>第一个是google的code lab。非常系统的讲解了从一个普通的应用如何变成PWA应用。步骤详细，容易上手。</p>
<p>第二个是Angular官方的PWA文档，Angular的好处就是官方CLI提供了工具，能后快速的帮你完成基础的配置，省力但是存在一些难度和问题，需要自己处理。</p>
<p>下面开始正片环节！</p>
<h3 id="什么是PWA"><a href="#什么是PWA" class="headerlink" title="什么是PWA"></a>什么是PWA</h3><p>PWA全称Progressive web app，中文名称渐进式Web应用。</p>
<p>至于PWA的特点，优势，前世今生这些细节，我给各位小伙伴找了一篇文章，来自<strong>王玉略</strong>同学的<a target="_blank" rel="noopener" href="https://juejin.im/post/6844903556470816781">简单介绍一下Progressive Web App(PWA)</a>.文章写的很详细，为了保证各位小伙伴看到的都是不重复的资源信息，我就不重复这些了。</p>
<blockquote>
<p>ps: @王玉略 同学记得来点赞~</p>
</blockquote>
<h3 id="为什么我选择PWA"><a href="#为什么我选择PWA" class="headerlink" title="为什么我选择PWA"></a>为什么我选择PWA</h3><p>如果为我们将PWA用在真实的项目上，就需要有我们技术选型的依据。为什么选择PWA？</p>
<p>先说一下项目需求，我们需要开发一款跨端的应用，并且该应用很大部分情况下是在离线使用。</p>
<p>应用的主要功能在于用户输入数据的展示，并且数据量不大。</p>
<p>开发周期三个月，包含需求确定，UI/UX，开发，部署。</p>
<p>需要开发的内容， client APP， BFF(Back-end For Front-end)， Back-end.</p>
<p>开发人员， 两名。<br>估算之后的开发实际时间大约一个半月。</p>
<p>我需要开发client APP和BFF。</p>
<p>再加上我之前并没有React Native的经验，所以如果选择React Native我并不能保证在计划时间内完成开发任务，更不要说Flutter或者原生开发了。</p>
<p>其实我们认真分析项目可以发现核心需求只有一个，那就是离线使用。所以传统的网页并能满足，但是PWA的特点就是可以离线运行，所以PWA可以完美的满足核心需求。</p>
<h3 id="开发环境"><a href="#开发环境" class="headerlink" title="开发环境"></a>开发环境</h3><ul>
<li>windows: 10</li>
<li>node: 10.16.3</li>
<li>npm: 6.9.0</li>
<li>Angular CLI: 9.0.6</li>
<li>Angular: 9.0.6</li>
<li>Chrome: 80.0.3987.163</li>
</ul>
<h3 id="初始化Angular-APP"><a href="#初始化Angular-APP" class="headerlink" title="初始化Angular APP"></a>初始化Angular APP</h3><p>ok, 下面进入正题，首先却创建项目。</p>
<p><code>ng new ng-pwa-app --prefix=slb</code></p>
<p>这样一个完整的Angular项目 GET！</p>
<p>接下来我们借助Angular CLI的支持执行下面这行命令。</p>
<p><code>ng add @angular/pwa --project *project-name*</code></p>
<p>对应到我们的项目就是</p>
<p><code>ng add @angular/pwa --project ng-pwa-app</code></p>
<p>到这里，我们得到了一个PWA的项目。</p>
<p>好，本期教程到此结束~</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/4/6/1714e78ec2326baf?w=870&h=832&f=png&s=280326"><br>错了，错了，我们继续…</p>
<p>我们首先来看下这条命令都背着我们做了什么事情。</p>
<ul>
<li>安装 <code>@angular/service-worker</code></li>
<li>启用service worker build</li>
<li>在app module 注册service worker</li>
<li>在index.html 引入<code>manifest</code> 和 <code>theme-color</code></li>
<li>增加icon</li>
<li>创建 <code>ngsw-config.json</code></li>
</ul>
<p>接下来我们将项目编译一下</p>
<p><code>ng build --prod</code></p>
<p>编译之后我们会得到<code>dist/ng-pwa-app/</code>目录下的编译结果。</p>
<p>至于为什么我们不直接使用 <code>ng serve</code>来测试呢？ </p>
<p>答案当然是 <code>ng serve</code> 不能够支持PWA</p>
<p>这时候我们需要一个server 来 host 我们的app,这里我们使用<code>http-serve</code>.</p>
<p>全局安装 http-serve <code>npm i http-server -g</code></p>
<p>接下来我们就可以运行一下我们的项目了~</p>
<p>执行下面这行命令</p>
<p><code>http-server -p 8080 -c-1 dist/ng-pwa-app</code></p>
<p>查看<code>localhost:8080</code></p>
<p>告诉我，你看到了下图~</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/4/6/1714f0a23b7dcc13?w=765&h=684&f=png&s=33173"></p>
<p>到这里我们先不继续往下深入，先看一下Angular CLI背着我们具体做的东西。</p>
<h3 id="manifest"><a href="#manifest" class="headerlink" title="manifest"></a>manifest</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;ng-pwa-app&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;short_name&quot;</span>: <span class="string">&quot;ng-pwa-app&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;theme_color&quot;</span>: <span class="string">&quot;#1976d2&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;background_color&quot;</span>: <span class="string">&quot;#fafafa&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;display&quot;</span>: <span class="string">&quot;standalone&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;scope&quot;</span>: <span class="string">&quot;./&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;start_url&quot;</span>: <span class="string">&quot;./&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;icons&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;src&quot;</span>: <span class="string">&quot;assets/icons/icon-72x72.png&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;sizes&quot;</span>: <span class="string">&quot;72x72&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;image/png&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;purpose&quot;</span>: <span class="string">&quot;maskable&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;src&quot;</span>: <span class="string">&quot;assets/icons/icon-96x96.png&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;sizes&quot;</span>: <span class="string">&quot;96x96&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;image/png&quot;</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;purpose&quot;: &quot;maskable&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;src&quot;</span>: <span class="string">&quot;assets/icons/icon-128x128.png&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;sizes&quot;</span>: <span class="string">&quot;128x128&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;image/png&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;purpose&quot;</span>: <span class="string">&quot;maskable&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">      &quot;src&quot;: &quot;assets/icons/icon-144x144.png&quot;,</span><br><span class="line">      &quot;sizes&quot;: &quot;144x144&quot;,</span><br><span class="line">      &quot;type&quot;: &quot;image/png&quot;,</span><br><span class="line">      &quot;purpose&quot;: &quot;maskable&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;src&quot;</span>: <span class="string">&quot;assets/icons/icon-152x152.png&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;sizes&quot;</span>: <span class="string">&quot;152x152&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;image/png&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;purpose&quot;</span>: <span class="string">&quot;maskable&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;src&quot;</span>: <span class="string">&quot;assets/icons/icon-192x192.png&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;sizes&quot;</span>: <span class="string">&quot;192x192&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;image/png&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;purpose&quot;</span>: <span class="string">&quot;maskable&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;src&quot;</span>: <span class="string">&quot;assets/icons/icon-384x384.png&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;sizes&quot;</span>: <span class="string">&quot;384x384&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;image/png&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;purpose&quot;</span>: <span class="string">&quot;maskable&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;src&quot;</span>: <span class="string">&quot;assets/icons/icon-512x512.png&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;sizes&quot;</span>: <span class="string">&quot;512x512&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;image/png&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;purpose&quot;</span>: <span class="string">&quot;maskable&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的manifest 文件是CLI帮我们生成的</p>
<ul>
<li>name: 项目名称</li>
<li>theme_color: 主题颜色</li>
<li>display: 运行方式</li>
<li>start_url: 加载目录或者说入口地址</li>
<li>icons: 图标数组，针对不同尺寸</li>
</ul>
<h3 id="ngsw-config-json"><a href="#ngsw-config-json" class="headerlink" title="ngsw-config.json"></a>ngsw-config.json</h3><p>如果你之前接触过Angular的worker的话，就会知道Angular引入worker并不是我们创建一个worker.js,而是提供一个配置json,然后根据你的配置自动帮你生成worker js 文件。</p>
<p>下面就是这个配置文件的内容：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;$schema&quot;</span>: <span class="string">&quot;./node_modules/@angular/service-worker/config/schema.json&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;index&quot;</span>: <span class="string">&quot;/index.html&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;assetGroups&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;app&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;installMode&quot;</span>: <span class="string">&quot;prefetch&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;resources&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;files&quot;</span>: [</span><br><span class="line">          <span class="string">&quot;/favicon.ico&quot;</span>,</span><br><span class="line">          <span class="string">&quot;/index.html&quot;</span>,</span><br><span class="line">          <span class="string">&quot;/manifest.webmanifest&quot;</span>,</span><br><span class="line">          <span class="string">&quot;/*.css&quot;</span>,</span><br><span class="line">          <span class="string">&quot;/*.js&quot;</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;assets&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;installMode&quot;</span>: <span class="string">&quot;lazy&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;updateMode&quot;</span>: <span class="string">&quot;prefetch&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;resources&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;files&quot;</span>: [</span><br><span class="line">          <span class="string">&quot;/assets/**&quot;</span>,</span><br><span class="line">          <span class="string">&quot;/*.(eot|svg|cur|jpg|png|webp|gif|otf|ttf|woff|woff2|ani)&quot;</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>针对这个文件，我们讲两部分</p>
<h4 id="assetGroups"><a href="#assetGroups" class="headerlink" title="assetGroups"></a>assetGroups</h4><p>关于assetGroups，它出现在了上面的json文件中，从上面的内容你可以发现，这部分是与应用一起加载的资源，同时也会一起更新。因为我们在开始就已经知道了这些具体的资源，所以我们可以将这些明确的资源配置在这里。</p>
<p>主要包括了应用的运行类资源，html,js,css等等资源，还有就是一些文件资源，svg,png,ttf等资源。</p>
<p>具体细节如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> AssetGroup &#123;</span><br><span class="line">  name: <span class="built_in">string</span>;</span><br><span class="line">  installMode?: <span class="string">&#x27;prefetch&#x27;</span> | <span class="string">&#x27;lazy&#x27;</span>;</span><br><span class="line">  updateMode?: <span class="string">&#x27;prefetch&#x27;</span> | <span class="string">&#x27;lazy&#x27;</span>;</span><br><span class="line">  resources: &#123;</span><br><span class="line">    files?: <span class="built_in">string</span>[];</span><br><span class="line">    urls?: <span class="built_in">string</span>[];</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="dataGroups"><a href="#dataGroups" class="headerlink" title="dataGroups"></a>dataGroups</h4><p>关于dataGroups的配置我们在上面并没有体现，那是因为这部分的缓存的资源是随应用执行而产生和发生变化的。</p>
<p>比如接口返回的缓存。</p>
<p>具体细节如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> DataGroup &#123;</span><br><span class="line">  name: <span class="built_in">string</span>;</span><br><span class="line">  urls: <span class="built_in">string</span>[];</span><br><span class="line">  version?: <span class="built_in">number</span>;</span><br><span class="line">  cacheConfig: &#123;</span><br><span class="line">    maxSize: <span class="built_in">number</span>;</span><br><span class="line">    maxAge: <span class="built_in">string</span>;</span><br><span class="line">    timeout?: <span class="built_in">string</span>;</span><br><span class="line">    strategy?: <span class="string">&#x27;freshness&#x27;</span> | <span class="string">&#x27;performance&#x27;</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>说明一点，其中的urls的内容是一个匹配策略。你可以将你希望缓存的所有地址写在这里。</p>
<h3 id="运行lighthouse"><a href="#运行lighthouse" class="headerlink" title="运行lighthouse"></a>运行lighthouse</h3><p>打开chrome 的dev tool, 选择 Audits页。</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/4/6/1714f23f230be515?w=764&h=686&f=png&s=49066"></p>
<p>点击 Generate report, 等待结果。</p>
<p>向下滑动页面，查看Progressive Web App相关的内容。如下：</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/4/6/1714f25cf4fa8e9a?w=762&h=946&f=png&s=72831"></p>
<p>从这里的结果上我们可以发现我们目前存在两个问题。</p>
<ul>
<li>我们没使用https,先忽略这个问题，真实的生产环境你一定需要部署到https的server上。</li>
<li>缺少app-touch-icon</li>
</ul>
<p>我们需要处理的就是第二项。</p>
<p>处理的方法其实很简单，就是需要在index.html页面添加</p>
<p><code> &lt;link rel=&quot;apple-touch-icon&quot; href=&quot;assets/icons/icon-144x144.png&quot;&gt;</code></p>
<p>添加之后重新编译，和重启server.</p>
<p>重新运行Lighthouse.</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/4/6/1714f2c572093af4?w=1153&h=964&f=png&s=85412"></p>
<p>重新执行之后我们发现，错误只剩下https的问题了。但是我们依然没有在地址栏的右边看到安装按钮。这是为什么？</p>
<p>既然这里Lighthouse不能发现问题，那么我们切换到Application页面看一下。</p>
<p>进入Application tab下，左侧选择Manifest.</p>
<p>我们发现了下面的警告！</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/4/6/1714f3243f88d11c?w=1381&h=263&f=png&s=25817"></p>
<p>上面的警告说我们的给的图片不合适？可是，这不是官方的图标吗？？？</p>
<p>网上搜索了一番，发现有人也遇到了这个问题，但是没有看到合适的回答。</p>
<p>一番折腾之后我发现了一个解决方案，去manifest里面修改144X144这个图片的perpose.</p>
<p>从默认的<code>maskable</code> 修改为 <code>any</code>.</p>
<p>然后重新编译，重启server,刷新页面。</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/4/6/1714f42468235632?w=624&h=201&f=png&s=13546"></p>
<p>点击安装：</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/4/6/1714f43a75c7ae38?w=629&h=222&f=png&s=18823"></p>
<p>变样子了对吗？</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/4/6/1714f4444161d405?w=928&h=742&f=png&s=59601"></p>
<p>到这里，各位小伙伴现在请站起来给自己鼓鼓掌。你已经得到了一个可以安装的PWA应用的~</p>
<h3 id="处理更新"><a href="#处理更新" class="headerlink" title="处理更新"></a>处理更新</h3><p>上面我们得到了应用之后，用户就可以安装到桌面了，但是如果我们服务端更新了，但是用户这个没有同步怎么办？</p>
<p>Angular的SwUpdate给我们提供了这些功能。</p>
<p>SwUpdate 服务支持四个独立的操作：</p>
<ul>
<li><p>获取出现可用更新的通知。如果要刷新页面，这些就是可加载的新版本。</p>
</li>
<li><p>获取更新被激活的通知。这时候 Service Worker 就可以立即使用这些新版本提供服务了。</p>
</li>
<li><p>要求 Service Worker 向服务器查询是否有新版本。</p>
</li>
<li><p>要求 Service Worker </p>
</li>
</ul>
<p>我们在 <code>app.component.ts</code>里面创建两个方法。</p>
<p>监听更新：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> _listenOnUpdate() &#123;</span><br><span class="line">    <span class="built_in">this</span>.updates.available.subscribe(<span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;current version is&#x27;</span>, event.current);</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;available version is&#x27;</span>, event.available);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">this</span>.updates.activated.subscribe(<span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;old version was&#x27;</span>, event.previous);</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;new version is&#x27;</span>, event.current);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>如果发现可用更新或者已激活更新，我们就会看到上面的Log，具体发现更新之后的处理，你可以根据实际需求来决定。</p>
<p>比如你可以弹框提醒用户刷新页面。</p>
<p>触发更新：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> _checkForUpdate() &#123;</span><br><span class="line">    <span class="keyword">const</span> appIsStable$ = <span class="built_in">this</span>.appRef.isStable.pipe(first(<span class="function"><span class="params">isStable</span> =&gt;</span> isStable === <span class="literal">true</span>));</span><br><span class="line">    <span class="keyword">const</span> everySixHours$ = interval(<span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">6</span>);</span><br><span class="line">    <span class="keyword">const</span> everySixHoursOnceAppIsStable$ = concat(appIsStable$, everySixHours$);</span><br><span class="line"></span><br><span class="line">    everySixHoursOnceAppIsStable$.subscribe(<span class="function">() =&gt;</span> <span class="built_in">this</span>.updates.checkForUpdate());</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>这里设置的是每6小时触发一个检测更新。</p>
<p>完整代码：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Component, ApplicationRef, ChangeDetectionStrategy &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/core&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; SwUpdate &#125; <span class="keyword">from</span> <span class="string">&#x27;@angular/service-worker&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; interval, concat &#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; first &#125; <span class="keyword">from</span> <span class="string">&#x27;rxjs/operators&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  selector: <span class="string">&#x27;slb-root&#x27;</span>,</span><br><span class="line">  templateUrl: <span class="string">&#x27;./app.component.html&#x27;</span>,</span><br><span class="line">  styleUrls: [<span class="string">&#x27;./app.component.scss&#x27;</span>],</span><br><span class="line">  changeDetection: ChangeDetectionStrategy.OnPush</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppComponent &#123;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params"><span class="keyword">private</span> updates: SwUpdate, <span class="keyword">private</span> appRef: ApplicationRef</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>._checkForUpdate();</span><br><span class="line">    <span class="built_in">this</span>._listenOnUpdate();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> _listenOnUpdate() &#123;</span><br><span class="line">    <span class="built_in">this</span>.updates.available.subscribe(<span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;current version is&#x27;</span>, event.current);</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;available version is&#x27;</span>, event.available);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">this</span>.updates.activated.subscribe(<span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;old version was&#x27;</span>, event.previous);</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;new version is&#x27;</span>, event.current);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> _checkForUpdate() &#123;</span><br><span class="line">    <span class="keyword">const</span> appIsStable$ = <span class="built_in">this</span>.appRef.isStable.pipe(first(<span class="function"><span class="params">isStable</span> =&gt;</span> isStable === <span class="literal">true</span>));</span><br><span class="line">    <span class="keyword">const</span> everySixHours$ = interval(<span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">6</span>);</span><br><span class="line">    <span class="keyword">const</span> everySixHoursOnceAppIsStable$ = concat(appIsStable$, everySixHours$);</span><br><span class="line"></span><br><span class="line">    everySixHoursOnceAppIsStable$.subscribe(<span class="function">() =&gt;</span> <span class="built_in">this</span>.updates.checkForUpdate());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>到这里的话，传统的教程应该已经结束了，但是我们没有，我们还有补充教程。如何手动处理worker事件。</p>
<p>通过上面的教程我们已经知道了，Angular会帮我们生成worker.js 文件，但是在我们实际的项目中，我们有可能需要自己监听一些事件，然后自定义一些处理。但是我们没有worker.js 文件，这时候怎么做？？</p>
<p>动一下你聪明的小脑瓜，想一下？</p>
<p>其实很简单，那就是我们自己写一个worker.js替换默认的。</p>
<p>当然，并不是简单的全部替换。</p>
<p>先上代码：</p>
<h4 id="mien-worker-js"><a href="#mien-worker-js" class="headerlink" title="mien-worker.js"></a>mien-worker.js</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">self.onmessage = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(e, <span class="string">&#x27;message from mien\&#x27;s custom worker service...&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line">importScripts(<span class="string">&#x27;./ngsw-worker.js&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>在我们自定义的worker.js 内，我们自己注册事件。在最后要做的就是把Angular帮我们做的事情拿过来用。</p>
<p><code>importScripts(&#39;./ngsw-worker.js&#39;)</code></p>
<p>我们再到 <code>app.module.ts</code>去修改worker的注册。</p>
<p>从之前的：</p>
<p><code>ServiceWorkerModule.register(&#39;ngsw-worker.js&#39;, &#123; enabled: environment.production &#125;),</code></p>
<p>修改为：</p>
<p><code>ServiceWorkerModule.register(&#39;mien-worker.js&#39;, &#123; enabled: environment.production &#125;),</code></p>
<p>再有把我们worker文件加入到资源列表，这样这个js 就不会被编译进main.js内了。</p>
<h3 id="Angular-json"><a href="#Angular-json" class="headerlink" title="Angular.json"></a>Angular.json</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&quot;assets&quot;: [</span><br><span class="line">              &quot;src&#x2F;favicon.ico&quot;,</span><br><span class="line">              &quot;src&#x2F;assets&quot;,</span><br><span class="line">              &quot;src&#x2F;manifest.webmanifest&quot;,</span><br><span class="line">              &quot;src&#x2F;mien-worker.js&quot;</span><br><span class="line">            ],</span><br></pre></td></tr></table></figure>

<p>新增的内容是 <code>src/mien-worker.js</code>.</p>
<p>来看效果：</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/4/6/1714f604d0d21816?w=1255&h=116&f=png&s=19470"></p>
<p>OK~</p>
<p>到这里，本期的更新 <strong>Angular PWA 入坑指北</strong> 就全部结束了。</p>
<p>在这里我公布一个计划，我计划开一个系列专栏。从头学习javascript。在现在所有人只关心三大框架，小程序，Flutter的时候，我觉得基础才是最重要的基石，良好的基础能让你在学习新知识的时候信手拈来。哪怕是看源代码的时候也能得心应手。</p>
<p>如果你感兴趣，请留言告诉我吧。</p>
<blockquote>
<p>Mien, 5年前端开发经验，目前就职于<strong>斯伦贝谢</strong>。</p>
</blockquote>
<blockquote>
<p>涉猎范围： Angular, Vue, React, 小程序, electron, nodeJS以及一些乱七八糟的技术</p>
</blockquote>
<blockquote>
<p>欢迎留言提问和指正。</p>
</blockquote>
<p>我们下周再见~</p>

                                                                        
                                    </div>
                                    <footer class="article-footer">
                                        <a data-url="https://mienhuang.github.io/2020/08/02/Angular-PWA-%E5%85%A5%E5%9D%91%E6%8C%87%E5%8C%97/" data-id="ckdcw0uw2000020vi6gsrd3y4" class="article-share-link">
                                            Share
                                        </a>
                                        
                                    </footer>

    </div>

    

                

</article>
        
          <article id="post-Angular-从创建项目到打包docker-image-发布" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

    <div class="article-inner">
        
            <header class="article-header">
                
  
    <h2 itemprop="name">
      <a class="article-title" href="/2020/08/02/Angular-%E4%BB%8E%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE%E5%88%B0%E6%89%93%E5%8C%85docker-image-%E5%8F%91%E5%B8%83/">Angular 从创建项目到打包docker image 发布</a>
    </h2>
  
  




            </header>
            

                
                    <div class="article-meta">
                        <a href="/2020/08/02/Angular-%E4%BB%8E%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE%E5%88%B0%E6%89%93%E5%8C%85docker-image-%E5%8F%91%E5%B8%83/" class="article-date">
  <time datetime="2020-08-02T09:17:30.000Z" itemprop="datePublished">2020-08-02</time>
</a>
                            
                    </div>
                    

                        

                                    <div class="article-entry" itemprop="articleBody">
                                        


                                            

                                                
                                                                    <blockquote>
<p>hello，各位亲爱的小伙伴大家好啊.<br>又是一个崭新且阳光明媚的下午,今天我们要学习的是如何从创建一个Angular的项目到打包成docker image并部署到自己的服务器上。</p>
</blockquote>
<p><img src="https://user-gold-cdn.xitu.io/2020/4/19/17191a5a297f4271?w=1240&h=992&f=png&s=26050"></p>
<p>让自己的站点运行在docker上，听起来是不是很酷？</p>
<p>那就让我们开始吧！</p>
<h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><p>首先呢，我们简单介绍一下我们的开发环境和工具。</p>
<ul>
<li>windows 10</li>
<li>docker desktop: 2.2.0.5</li>
<li>vs code</li>
<li>Terminus</li>
<li>Angular 9.0.6</li>
<li>Angular CLI:9.0.6</li>
<li>Nodejs: 12.16.1</li>
</ul>
<blockquote>
<p>Tips: 本教程不涉及docker 的安装。 </p>
</blockquote>
<p>介绍完了开发的工具和环境之后我们进入正题，先创建项目。</p>
<h3 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h3><p>关于如何使用Angular-CLI 创建一个项目我想大家应该都已经很清楚了对吧。</p>
<p>就是 <code>ng new docker-demo --prefix=mien</code></p>
<p>创建成功之后我们进入目录，运行程序。</p>
<p><code>cd docker-demo &amp;&amp; ng serve</code></p>
<p>之后打开浏览器，访问<code>localhost:4200</code></p>
<p><img src="https://user-gold-cdn.xitu.io/2020/4/19/17191c44d3df9e5b?w=854&h=784&f=png&s=45836"></p>
<p>还是原来的UI还是熟悉的味道对吧。</p>
<p>OK，下面进入docker部分。</p>
<h3 id="流程分析"><a href="#流程分析" class="headerlink" title="流程分析"></a>流程分析</h3><p>在开始写代码之前，我们先来做一个流程分析。</p>
<ol>
<li><p>服务端的运行环境。</p>
<p> 我们的应用是运行在docker上了，所以对于服务端而言，只需要安装docker即可。</p>
</li>
<li><p>前端的挂载环境。</p>
<p> 在我们这个示例中，我们使用nginx来host前端项目。</p>
</li>
<li><p>打包流程。</p>
<p> 使用过nginx的童鞋应该很清楚，最简单的操作就是把需要host的项目代码放到nginx的html目录下即可。我们呢，就按照最简单的来，不涉及额外的配置。</p>
<p> 对应到我们的项目其实就是：</p>
<ul>
<li><p><code>npm install</code></p>
</li>
<li><p><code>npm run build --prod</code></p>
</li>
<li><p>copy 编译结果到nginx 的html目录下</p>
<p>所以，看上去还是很简单的嘛</p>
</li>
</ul>
</li>
</ol>
<h3 id="查看本地Image"><a href="#查看本地Image" class="headerlink" title="查看本地Image"></a>查看本地Image</h3><p>首先我们查看本地已经存在的image和正在运行的image。</p>
<p>执行 <code>docker images</code> 和 <code>docker ps</code></p>
<p><img src="https://user-gold-cdn.xitu.io/2020/4/19/17191ca546f79fc2?w=901&h=214&f=png&s=19354"></p>
<p>OK，本地目前只有node 和 nginx 的image。</p>
<p>当然还有一个我们这次教程不涉及的<code>portainer</code>,这个是什么？其实就是一个可视化的docker 管理工具。</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/4/19/1719278024d69a68?w=853&h=835&f=png&s=70974"></p>
<p>对于不是很喜欢敲命令的童鞋，这个工具还是很好用的。</p>
<h3 id="选取docker-image"><a href="#选取docker-image" class="headerlink" title="选取docker image"></a>选取docker image</h3><p>我们这里需要用的第三方image有两个，一个是node,另一个是nginx。那么第一步就是到docker hub 去查看需要的版本。</p>
<p><code>https://hub.docker.com/</code></p>
<ol>
<li>查看 node</li>
</ol>
<p><img src="https://user-gold-cdn.xitu.io/2020/4/19/171927c937eb64bb?w=766&h=287&f=png&s=16139"></p>
<p><img src="https://user-gold-cdn.xitu.io/2020/4/19/171927d345712438?w=921&h=299&f=png&s=19867"></p>
<p>对于Node 的版本选择，我们尽量使用最新的版本。所以我们选择<strong>13</strong>这个版本。</p>
<ol start="2">
<li>查看 nginx</li>
</ol>
<p><img src="https://user-gold-cdn.xitu.io/2020/4/19/171927ed7ab6f7a8?w=769&h=284&f=png&s=14967"></p>
<p><img src="https://user-gold-cdn.xitu.io/2020/4/19/171927f09f0534d9?w=765&h=252&f=png&s=15134"></p>
<p>同样的我们选取新版本的1.17作为我们的nginx版本。</p>
<h3 id="创建dockerfile"><a href="#创建dockerfile" class="headerlink" title="创建dockerfile"></a>创建dockerfile</h3><p>dockerfile 其实就是一个流程安排的脚本文件，先做什么，再做什么，顺序执行。我们直接来看内容：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> node:<span class="number">13</span> as sdk</span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /app</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash">  npm install -g @angular/cli</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> ./docker-demo/package.json /app</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> npm install</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> node:<span class="number">13</span> as builder</span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /app</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> --from=sdk /app /app</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> ./docker-demo /app</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> npm run build</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> nginx:<span class="number">1.17</span>.<span class="number">9</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /app</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> rm -rf /usr/share/nginx/html/*</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> --from=builder /app/dist/docker-demo /usr/share/nginx/html</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> /bin/sh -c <span class="string">&quot;nginx -g &#x27;daemon off;&#x27;&quot;</span></span></span><br></pre></td></tr></table></figure>

<p>我们简单过一下上面的内容：</p>
<ul>
<li>指定环境，例如node 和nginx 使用<code>FROM</code>关键字</li>
<li>执行命令，例如npm i 使用<code>RUN</code>关键字</li>
<li>复制内容到指定位置，使用 <code>COPY from to</code></li>
<li>明确命令运行位置，使用 <code>WORKDIR</code></li>
<li>暴露端口号, 使用 <code>EXPOSE</code>。这里之所以是80是因为nginx的默认端口是80</li>
<li>指定入口，使用 <code>ENTRYPOINT</code></li>
</ul>
<h3 id="打包image"><a href="#打包image" class="headerlink" title="打包image"></a>打包image</h3><p>在目录下我们运行打包命令：</p>
<p><code>docker build -f Dockfile -t d-demo:latest .</code></p>
<p>解释一下这条命令</p>
<p><code>docker build</code> 就是运行编译指令</p>
<p><code>-f Dockerfile</code> 就是指定Dockfile的位置</p>
<p><code>-t d-demo:latest</code> 就是对image的tag名称</p>
<p><code>.</code> 表示执行目录为当前目录</p>
<p>命令执行结束之后，我们使用<code>docker images</code> 查看当前存在的docker image。就能发现我们刚才创建的<code>d-demo:latest</code>了。</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/4/20/1719553f61abefbf?w=848&h=121&f=png&s=11310"></p>
<h3 id="导出image"><a href="#导出image" class="headerlink" title="导出image"></a>导出image</h3><p>正常的流程打包过程是在线上的pipeline 执行的，但是我们目前是学习过程，所以就在本地执行。那么我们就需要把我们编译成功的镜像导出成文件，这样我们才能在服务端使用。</p>
<p>下面说一下docker 的image 导出命令。</p>
<p><code>docker save -o d-demo.tar d-demo:latest</code></p>
<p><code>docker save</code>就是我们要掌握的保存image的命令.</p>
<p><code>-o</code>表示保存文件</p>
<p>然后就是要保存的文件名 和要保存的image</p>
<p>然后我们查看本地文件。</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/4/20/171955bf67434d89?w=801&h=154&f=png&s=8780"></p>
<p>我们看到了我们刚才指定的压缩包对吧。</p>
<h3 id="运行image"><a href="#运行image" class="headerlink" title="运行image"></a>运行image</h3><p>既然编译和导出都学会了，那么就让它运行起来吧。</p>
<p><code>docker run -d -p 8090:80 d-demo:latest</code></p>
<p><code>docker run</code>又一个各位童鞋需要掌握的命令。</p>
<p><code>-d</code> 后台运行</p>
<p><code>-p</code> 指定端口映射，这里其实就是把image的80端口映射到8090，这样我们访问8090即可。</p>
<p>然后就是image的名称了</p>
<p>执行命令之后我们就可以使用<code>docker ps</code>来查看当前运行的image</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/4/20/171956168a54084e?w=1052&h=120&f=png&s=10916"></p>
<p>LOOK~ LOOK~ 我们的image在运行了对吧。就是这么的简单！</p>
<p>下面就是见证奇迹的时刻，然我们浏览器访问一下。</p>
<p>当当当当~</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/4/20/171956355a65841d?w=814&h=784&f=png&s=47153"></p>
<p>不要说我没换图哦<del>看端口号</del></p>
<p>好了，这些就是本次教程的全部内容了。当然我写的很简单，但是其实里面还是存在很多坑的。比如dockerfile里面的执行顺序，还有一些看起来不需要的操作，你去掉就会发现报错了。</p>
<p>如果小伙伴感兴趣的话，我们可以再做一个后续。当然还有docker compose, K8S这些我们都没有涉及。如果你想看的话，那就留言告诉我吧。</p>
<blockquote>
<p>作者：Mien，目前供职于<strong>斯伦贝谢</strong>。</p>
</blockquote>
<blockquote>
<p>涉猎范围： Angular, Vue, React, 小程序, electron, nodeJS以及一些乱七八糟的技术</p>
</blockquote>
<blockquote>
<p>欢迎留言提问和指正。</p>
</blockquote>
<p>我们下周再见~</p>

                                                                        
                                    </div>
                                    <footer class="article-footer">
                                        <a data-url="https://mienhuang.github.io/2020/08/02/Angular-%E4%BB%8E%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE%E5%88%B0%E6%89%93%E5%8C%85docker-image-%E5%8F%91%E5%B8%83/" data-id="ckdcw0uw7000120viaw5d0b8n" class="article-share-link">
                                            Share
                                        </a>
                                        
                                    </footer>

    </div>

    

                

</article>
        
    </article>
    
  
    
  </section>
</div>

  <footer class="footer">
  <div class="outer">
    <div class="float-right">
      <ul class="list-inline">
  
    <li><i class="fe fe-bar-chart"></i> <span id="busuanzi_value_site_pv"></span></li>
  
    <li><i class="fe fe-smile-alt"></i> <span id="busuanzi_value_site_uv"></span></li>
  
</ul>
    </div>
    <ul class="list-inline">
      <li>&copy; 2020 Mien&#39;s Grown Diary</li>
      <li>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></li>
      <li>Theme  <a target="_blank" rel="noopener" href="https://github.com/zhwangart/hexo-theme-ocean">Ocean</a></li>
    </ul>
  </div>
</footer>

</main>
<aside class="sidebar">
  <button class="navbar-toggle"></button>
<nav class="navbar">
  
    <div class="logo">
      <a href="/"><img src="/images/hexo.svg" alt="Mien&#39;s Grown Diary"></a>
    </div>
  
  <ul class="nav nav-main">
    
      <li class="nav-item">
        <a class="nav-item-link" href="/">Home</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/archives">Archives</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/gallery">Gallery</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/about">About</a>
      </li>
    
    <li class="nav-item">
      <a class="nav-item-link nav-item-search" title="Search">
        <i class="fe fe-search"></i>
        Search
      </a>
    </li>
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      <div class="totop" id="totop">
  <i class="fe fe-rocket"></i>
</div>
    </li>
    <li class="nav-item">
      
        <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
          <i class="fe fe-feed"></i>
        </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
</aside>

<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/jquery.justifiedGallery.min.js"></script>


<script src="/js/lazyload.min.js"></script>


<script src="/js/busuanzi-2.3.pure.min.js"></script>


  
<script src="/fancybox/jquery.fancybox.min.js"></script>






<script src="/js/ocean.js"></script>


</body>
</html>